<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”½ì…€ì•„íŠ¸ ì—ë””í„°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .tools {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            align-items: center;
        }
        
        .tool-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .color-picker {
            width: 50px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        #pixelCanvas {
            border: 2px solid #333;
            cursor: crosshair;
            background-color: white;
            image-rendering: pixelated;
        }
        
        .controls {
            text-align: center;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button.active {
            background-color: #28a745;
        }
        
        select, input {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .preset-colors {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
            max-width: 800px;
        }
        
        .preset-color {
            width: 25px;
            height: 25px;
            border: 2px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }
        
        .preset-color:hover {
            border-color: #333;
            transform: scale(1.1);
        }
        
        /* NFT ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .nft-section {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-left: 20px;
            padding-left: 20px;
            border-left: 2px solid #ddd;
        }
        
        #walletStatus {
            font-size: 12px;
            color: #666;
            background-color: #f8f9fa;
            padding: 5px 10px;
            border-radius: 15px;
        }
        
        #walletStatus.connected {
            color: #28a745;
            background-color: #d4edda;
        }
        
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        
        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        #confirmMint {
            background-color: #28a745;
        }
        
        #confirmMint:hover {
            background-color: #218838;
        }
        
        #cancelMint {
            background-color: #6c757d;
        }
        
        #cancelMint:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ í”½ì…€ì•„íŠ¸ ì—ë””í„°</h1>
        </div>
        
        <div class="tools">
            <div class="tool-group">
                <label>ìº”ë²„ìŠ¤ í¬ê¸°:</label>
                <select id="canvasSize">
                    <option value="8">8x8</option>
                    <option value="16" selected>16x16</option>
                    <option value="32">32x32</option>
                    <option value="64">64x64</option>
                </select>
            </div>
            
            <div class="tool-group">
                <label>í”½ì…€ í¬ê¸°:</label>
                <select id="pixelSize">
                    <option value="16">16px</option>
                    <option value="20">20px</option>
                    <option value="24">24px</option>
                    <option value="32" selected>32px</option>
                    <option value="40">40px</option>
                </select>
            </div>
            
            <div class="tool-group">
                <label>ìƒ‰ìƒ:</label>
                <input type="color" id="colorPicker" class="color-picker" value="#000000">
            </div>
            
            <div class="tool-group">
                <button id="penTool" class="active">íœ</button>
                <button id="eraserTool">ì§€ìš°ê°œ</button>
                <button id="bucketTool">ì±„ìš°ê¸°</button>
            </div>
        </div>
        
        <div class="tools">
            <div class="tool-group">
                <label>í”„ë¦¬ì…‹ ìƒ‰ìƒ:</label>
                <div class="preset-colors">
                    <!-- ê¸°ë³¸ ìƒ‰ìƒ -->
                    <div class="preset-color" style="background-color: #000000" data-color="#000000" title="ê²€ì •"></div>
                    <div class="preset-color" style="background-color: #ffffff" data-color="#ffffff" title="í°ìƒ‰"></div>
                    <div class="preset-color" style="background-color: #808080" data-color="#808080" title="íšŒìƒ‰"></div>
                    <div class="preset-color" style="background-color: #c0c0c0" data-color="#c0c0c0" title="ì—°í•œ íšŒìƒ‰"></div>
                    
                    <!-- ë¹¨ê°• ê³„ì—´ -->
                    <div class="preset-color" style="background-color: #ff0000" data-color="#ff0000" title="ë¹¨ê°•"></div>
                    <div class="preset-color" style="background-color: #ff6b6b" data-color="#ff6b6b" title="ì½”ë„"></div>
                    <div class="preset-color" style="background-color: #ff9999" data-color="#ff9999" title="ì—°í•œ ë¹¨ê°•"></div>
                    <div class="preset-color" style="background-color: #8b0000" data-color="#8b0000" title="ë‹¤í¬ ë ˆë“œ"></div>
                    
                    <!-- ì£¼í™© ê³„ì—´ -->
                    <div class="preset-color" style="background-color: #ffa500" data-color="#ffa500" title="ì˜¤ë Œì§€"></div>
                    <div class="preset-color" style="background-color: #ffb347" data-color="#ffb347" title="í”¼ì¹˜"></div>
                    <div class="preset-color" style="background-color: #ff8c00" data-color="#ff8c00" title="ë‹¤í¬ ì˜¤ë Œì§€"></div>
                    
                    <!-- ë…¸ë‘ ê³„ì—´ -->
                    <div class="preset-color" style="background-color: #ffff00" data-color="#ffff00" title="ë…¸ë‘"></div>
                    <div class="preset-color" style="background-color: #ffd700" data-color="#ffd700" title="ê³¨ë“œ"></div>
                    <div class="preset-color" style="background-color: #fff8dc" data-color="#fff8dc" title="í¬ë¦¼"></div>
                    
                    <!-- ì´ˆë¡ ê³„ì—´ -->
                    <div class="preset-color" style="background-color: #00ff00" data-color="#00ff00" title="ì´ˆë¡"></div>
                    <div class="preset-color" style="background-color: #4caf50" data-color="#4caf50" title="ê·¸ë¦°"></div>
                    <div class="preset-color" style="background-color: #90ee90" data-color="#90ee90" title="ì—°í•œ ì´ˆë¡"></div>
                    <div class="preset-color" style="background-color: #228b22" data-color="#228b22" title="í¬ë ˆìŠ¤íŠ¸ ê·¸ë¦°"></div>
                    <div class="preset-color" style="background-color: #32cd32" data-color="#32cd32" title="ë¼ì„ ê·¸ë¦°"></div>
                    
                    <!-- íŒŒë‘ ê³„ì—´ -->
                    <div class="preset-color" style="background-color: #0000ff" data-color="#0000ff" title="íŒŒë‘"></div>
                    <div class="preset-color" style="background-color: #4169e1" data-color="#4169e1" title="ë¡œì–„ ë¸”ë£¨"></div>
                    <div class="preset-color" style="background-color: #87ceeb" data-color="#87ceeb" title="ìŠ¤ì¹´ì´ ë¸”ë£¨"></div>
                    <div class="preset-color" style="background-color: #000080" data-color="#000080" title="ë„¤ì´ë¹„"></div>
                    <div class="preset-color" style="background-color: #1e90ff" data-color="#1e90ff" title="ë”¥ ìŠ¤ì¹´ì´ ë¸”ë£¨"></div>
                    
                    <!-- ë³´ë¼ ê³„ì—´ -->
                    <div class="preset-color" style="background-color: #9932cc" data-color="#9932cc" title="í¼í”Œ"></div>
                    <div class="preset-color" style="background-color: #dda0dd" data-color="#dda0dd" title="í”ŒëŸ¼"></div>
                    <div class="preset-color" style="background-color: #8a2be2" data-color="#8a2be2" title="ë°”ì´ì˜¬ë ›"></div>
                    <div class="preset-color" style="background-color: #e6e6fa" data-color="#e6e6fa" title="ë¼ë²¤ë”"></div>
                    
                    <!-- ë¶„í™ ê³„ì—´ -->
                    <div class="preset-color" style="background-color: #ff69b4" data-color="#ff69b4" title="í•« í•‘í¬"></div>
                    <div class="preset-color" style="background-color: #ffc0cb" data-color="#ffc0cb" title="í•‘í¬"></div>
                    <div class="preset-color" style="background-color: #ffb6c1" data-color="#ffb6c1" title="ë¼ì´íŠ¸ í•‘í¬"></div>
                    
                    <!-- ê°ˆìƒ‰ ê³„ì—´ -->
                    <div class="preset-color" style="background-color: #8b4513" data-color="#8b4513" title="ë¸Œë¼ìš´"></div>
                    <div class="preset-color" style="background-color: #d2691e" data-color="#d2691e" title="ì´ˆì½œë¦¿"></div>
                    <div class="preset-color" style="background-color: #daa520" data-color="#daa520" title="ê³¨ë“ ë¡œë“œ"></div>
                    
                    <!-- íŠ¹ë³„í•œ ìƒ‰ìƒë“¤ -->
                    <div class="preset-color" style="background-color: #00ffff" data-color="#00ffff" title="ì‹œì•ˆ"></div>
                    <div class="preset-color" style="background-color: #ff00ff" data-color="#ff00ff" title="ë§ˆì  íƒ€"></div>
                    <div class="preset-color" style="background-color: #40e0d0" data-color="#40e0d0" title="í„°ì½°ì´ì¦ˆ"></div>
                    <div class="preset-color" style="background-color: #98fb98" data-color="#98fb98" title="í˜ì¼ ê·¸ë¦°"></div>
                    <div class="preset-color" style="background-color: #f0e68c" data-color="#f0e68c" title="ì¹´í‚¤"></div>
                </div>
            </div>
        </div>
        
        <div class="canvas-container">
            <canvas id="pixelCanvas"></canvas>
        </div>
        
        <div class="controls">
            <button id="clearCanvas">ì „ì²´ ì§€ìš°ê¸°</button>
            <button id="downloadImage">PNG ë‹¤ìš´ë¡œë“œ</button>
            <button id="gridToggle">ê²©ì í† ê¸€</button>
            
            <!-- NFT ë¯¼íŒ… ì„¹ì…˜ -->
            <div class="nft-section">
                <button id="connectWallet">ì§€ê°‘ ì—°ê²°</button>
                <button id="mintNFT" disabled>NFT ë¯¼íŒ…</button>
                <span id="walletStatus">ì§€ê°‘ ì—°ê²° ì•ˆë¨</span>
            </div>
        </div>
        
        <!-- NFT ë©”íƒ€ë°ì´í„° ëª¨ë‹¬ -->
        <div id="nftModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>NFT ë©”íƒ€ë°ì´í„° ì…ë ¥</h2>
                <form id="nftForm">
                    <div class="form-group">
                        <label for="nftName">ì‘í’ˆ ì œëª©:</label>
                        <input type="text" id="nftName" required placeholder="ì˜ˆ: My Pixel Art">
                    </div>
                    <div class="form-group">
                        <label for="nftDescription">ì„¤ëª…:</label>
                        <textarea id="nftDescription" placeholder="ì‘í’ˆì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="nftAttributes">ì†ì„± (ì„ íƒì‚¬í•­):</label>
                        <input type="text" id="nftAttributes" placeholder="ì˜ˆ: ìƒ‰ìƒ:ë¹¨ê°•, í¬ê¸°:16x16">
                    </div>
                    <div class="form-buttons">
                        <button type="button" id="cancelMint">ì·¨ì†Œ</button>
                        <button type="submit" id="confirmMint">ë¯¼íŒ…í•˜ê¸°</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.10.0/web3.min.js"></script>
    <script>
        class PixelArtEditor {
            constructor() {
                this.canvas = document.getElementById('pixelCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gridSize = 16;
                this.pixelSize = 32;
                this.currentColor = '#000000';
                this.currentTool = 'pen';
                this.isDrawing = false;
                this.showGrid = true;
                this.pixels = {};
                
                // Web3 ê´€ë ¨
                this.web3 = null;
                this.account = null;
                this.contract = null;
                
                // ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì •ë³´ (Mumbai í…ŒìŠ¤íŠ¸ë„·)
                this.contractAddress = "0x1234567890123456789012345678901234567890"; // ë°°í¬ í›„ ì—…ë°ì´íŠ¸ í•„ìš”
                this.contractABI = [
                    {
                        "inputs": [
                            {"internalType": "address", "name": "to", "type": "address"},
                            {"internalType": "string", "name": "tokenURI", "type": "string"}
                        ],
                        "name": "mint",
                        "outputs": [],
                        "stateMutability": "nonpayable",
                        "type": "function"
                    }
                ];
                
                this.initCanvas();
                this.bindEvents();
                this.initWeb3();
            }
            
            initCanvas() {
                const canvasPixelSize = this.gridSize * this.pixelSize;
                this.canvas.width = canvasPixelSize;
                this.canvas.height = canvasPixelSize;
                this.ctx.imageSmoothingEnabled = false;
                this.clearCanvas();
                this.drawGrid();
            }
            
            clearCanvas() {
                // ìº”ë²„ìŠ¤ ì™„ì „íˆ ì§€ìš°ê¸°
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // í°ìƒ‰ ë°°ê²½ìœ¼ë¡œ ì±„ìš°ê¸°
                this.ctx.fillStyle = '#ffffff';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // í”½ì…€ ë°ì´í„° ì´ˆê¸°í™”
                this.pixels = {};
                
                // ê²©ì ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                this.drawGrid();
                
                console.log('ìº”ë²„ìŠ¤ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤!'); // ë””ë²„ê¹…ìš©
            }
            
            drawGrid() {
                if (!this.showGrid) return;
                
                this.ctx.strokeStyle = '#e0e0e0';
                this.ctx.lineWidth = 1;
                
                for (let x = 0; x <= this.canvas.width; x += this.pixelSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }
                
                for (let y = 0; y <= this.canvas.height; y += this.pixelSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }
            }
            
            getPixelPosition(e) {
                const rect = this.canvas.getBoundingClientRect();
                const x = Math.floor((e.clientX - rect.left) / this.pixelSize);
                const y = Math.floor((e.clientY - rect.top) / this.pixelSize);
                return { x, y };
            }
            
            drawPixel(x, y, color) {
                const pixelX = x * this.pixelSize;
                const pixelY = y * this.pixelSize;
                
                this.ctx.fillStyle = color;
                this.ctx.fillRect(pixelX, pixelY, this.pixelSize, this.pixelSize);
                
                this.pixels[`${x},${y}`] = color;
                
                if (this.showGrid) {
                    this.ctx.strokeStyle = '#e0e0e0';
                    this.ctx.lineWidth = 1;
                    this.ctx.strokeRect(pixelX, pixelY, this.pixelSize, this.pixelSize);
                }
            }
            
            erasePixel(x, y) {
                this.drawPixel(x, y, '#ffffff');
                delete this.pixels[`${x},${y}`];
            }
            
            floodFill(x, y, newColor) {
                const key = `${x},${y}`;
                const originalColor = this.pixels[key] || '#ffffff';
                
                if (originalColor === newColor) return;
                
                const stack = [{x, y}];
                const visited = new Set();
                
                while (stack.length > 0) {
                    const {x: currentX, y: currentY} = stack.pop();
                    const currentKey = `${currentX},${currentY}`;
                    
                    if (visited.has(currentKey)) continue;
                    if (currentX < 0 || currentX >= this.gridSize || currentY < 0 || currentY >= this.gridSize) continue;
                    
                    const currentPixelColor = this.pixels[currentKey] || '#ffffff';
                    if (currentPixelColor !== originalColor) continue;
                    
                    visited.add(currentKey);
                    this.drawPixel(currentX, currentY, newColor);
                    
                    stack.push({x: currentX + 1, y: currentY});
                    stack.push({x: currentX - 1, y: currentY});
                    stack.push({x: currentX, y: currentY + 1});
                    stack.push({x: currentX, y: currentY - 1});
                }
            }
            
            handleCanvasClick(e) {
                const {x, y} = this.getPixelPosition(e);
                
                switch (this.currentTool) {
                    case 'pen':
                        this.drawPixel(x, y, this.currentColor);
                        break;
                    case 'eraser':
                        this.erasePixel(x, y);
                        break;
                    case 'bucket':
                        this.floodFill(x, y, this.currentColor);
                        break;
                }
            }
            
            redraw() {
                this.clearCanvas();
                
                // ì €ì¥ëœ í”½ì…€ë“¤ì„ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
                for (const [key, color] of Object.entries(this.pixels)) {
                    const [x, y] = key.split(',').map(Number);
                    const pixelX = x * this.pixelSize;
                    const pixelY = y * this.pixelSize;
                    
                    this.ctx.fillStyle = color;
                    this.ctx.fillRect(pixelX, pixelY, this.pixelSize, this.pixelSize);
                }
                
                this.drawGrid();
            }
            
            downloadImage() {
                // ê²©ì ì—†ëŠ” ê¹¨ë—í•œ ì´ë¯¸ì§€ ìƒì„±
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = this.gridSize;
                tempCanvas.height = this.gridSize;
                
                tempCtx.fillStyle = '#ffffff';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                
                for (const [key, color] of Object.entries(this.pixels)) {
                    const [x, y] = key.split(',').map(Number);
                    tempCtx.fillStyle = color;
                    tempCtx.fillRect(x, y, 1, 1);
                }
                
                const link = document.createElement('a');
                link.download = 'pixel-art.png';
                link.href = tempCanvas.toDataURL();
                link.click();
            }
            
            bindEvents() {
                // ìº”ë²„ìŠ¤ ì´ë²¤íŠ¸
                this.canvas.addEventListener('click', (e) => this.handleCanvasClick(e));
                
                this.canvas.addEventListener('mousedown', (e) => {
                    this.isDrawing = true;
                    this.handleCanvasClick(e);
                });
                
                this.canvas.addEventListener('mousemove', (e) => {
                    if (this.isDrawing && (this.currentTool === 'pen' || this.currentTool === 'eraser')) {
                        this.handleCanvasClick(e);
                    }
                });
                
                this.canvas.addEventListener('mouseup', () => {
                    this.isDrawing = false;
                });
                
                this.canvas.addEventListener('mouseleave', () => {
                    this.isDrawing = false;
                });
                
                // ë„êµ¬ ì´ë²¤íŠ¸
                document.getElementById('penTool').addEventListener('click', () => this.setTool('pen'));
                document.getElementById('eraserTool').addEventListener('click', () => this.setTool('eraser'));
                document.getElementById('bucketTool').addEventListener('click', () => this.setTool('bucket'));
                
                // ìƒ‰ìƒ ì´ë²¤íŠ¸
                document.getElementById('colorPicker').addEventListener('change', (e) => {
                    this.currentColor = e.target.value;
                });
                
                // í”„ë¦¬ì…‹ ìƒ‰ìƒ ì´ë²¤íŠ¸
                document.querySelectorAll('.preset-color').forEach(colorDiv => {
                    colorDiv.addEventListener('click', () => {
                        this.currentColor = colorDiv.dataset.color;
                        document.getElementById('colorPicker').value = this.currentColor;
                    });
                });
                
                // ìº”ë²„ìŠ¤ í¬ê¸° ë³€ê²½
                document.getElementById('canvasSize').addEventListener('change', (e) => {
                    this.gridSize = parseInt(e.target.value);
                    this.initCanvas();
                });
                
                // í”½ì…€ í¬ê¸° ë³€ê²½
                document.getElementById('pixelSize').addEventListener('change', (e) => {
                    this.pixelSize = parseInt(e.target.value);
                    this.initCanvas();
                    this.redraw();
                });
                
                // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ë“¤
                document.getElementById('clearCanvas').addEventListener('click', (e) => {
                    console.log('ì „ì²´ì§€ìš°ê¸° ë²„íŠ¼ í´ë¦­ë¨!'); // ë””ë²„ê¹…ìš©
                    
                    // ì¼ë‹¨ confirm ì—†ì´ ë°”ë¡œ ì§€ì›Œë³´ê¸° (í…ŒìŠ¤íŠ¸ìš©)
                    console.log('ìº”ë²„ìŠ¤ ì§€ìš°ê¸° ì‹¤í–‰ ì¤‘...'); 
                    this.clearCanvas();
                    
                    // ì‹¤ì œ ì‚¬ìš©ì‹œì—ëŠ” ì•„ë˜ ì½”ë“œ ì‚¬ìš©:
                    /*
                    const userConfirmed = confirm('ì •ë§ ëª¨ë“  ë‚´ìš©ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?');
                    if (userConfirmed) {
                        this.clearCanvas();
                    }
                    */
                });
                
                document.getElementById('downloadImage').addEventListener('click', () => this.downloadImage());
                
                document.getElementById('gridToggle').addEventListener('click', () => {
                    this.showGrid = !this.showGrid;
                    this.redraw();
                });
                
                // NFT ê´€ë ¨ ì´ë²¤íŠ¸
                document.getElementById('connectWallet').addEventListener('click', (e) => {
                    console.log('ì§€ê°‘ì—°ê²° ë²„íŠ¼ í´ë¦­ë¨!'); // ë””ë²„ê¹…ìš©
                    e.preventDefault();
                    this.connectWallet();
                });
                document.getElementById('mintNFT').addEventListener('click', () => this.openMintModal());
                document.getElementById('cancelMint').addEventListener('click', () => this.closeMintModal());
                document.getElementById('nftForm').addEventListener('submit', (e) => this.handleMintSubmit(e));
                document.querySelector('.close').addEventListener('click', () => this.closeMintModal());
                
                // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                document.getElementById('nftModal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('nftModal')) {
                        this.closeMintModal();
                    }
                });
            }
            
            setTool(tool) {
                this.currentTool = tool;
                
                // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.tools button').forEach(btn => btn.classList.remove('active'));
                document.getElementById(tool + 'Tool').classList.add('active');
                
                // ì»¤ì„œ ëª¨ì–‘ ë³€ê²½
                if (tool === 'bucket') {
                    this.canvas.style.cursor = 'pointer';
                } else {
                    this.canvas.style.cursor = 'crosshair';
                }
            }
            
            // Web3 ë° NFT ê´€ë ¨ ë©”ì†Œë“œë“¤
            async initWeb3() {
                if (typeof window.ethereum !== 'undefined') {
                    console.log('MetaMaskê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    console.log('MetaMaskë¥¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!');
                }
            }
            
            async connectWallet() {
                console.log('connectWallet í•¨ìˆ˜ ì‹¤í–‰ë¨!'); // ë””ë²„ê¹…ìš©
                
                try {
                    // MetaMask ì„¤ì¹˜ í™•ì¸
                    if (typeof window.ethereum === 'undefined') {
                        console.log('MetaMaskê°€ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ');
                        alert('MetaMaskë¥¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”!\n\n1. https://metamask.io ë°©ë¬¸\n2. MetaMask ì„¤ì¹˜\n3. ìƒˆ ì§€ê°‘ ìƒì„± ë˜ëŠ” ë³µì›');
                        window.open('https://metamask.io/download/', '_blank');
                        return;
                    }
                    
                    console.log('MetaMask ê°ì§€ë¨, ì—°ê²° ì‹œë„ ì¤‘...');
                    
                    // ê³„ì • ìš”ì²­
                    const accounts = await window.ethereum.request({
                        method: 'eth_requestAccounts'
                    });
                    
                    console.log('ì—°ê²°ëœ ê³„ì •:', accounts);
                    
                    if (accounts.length === 0) {
                        alert('MetaMaskì—ì„œ ê³„ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    this.account = accounts[0];
                    console.log('ì„ íƒëœ ê³„ì •:', this.account);
                    
                    // UI ì—…ë°ì´íŠ¸
                    const walletStatus = document.getElementById('walletStatus');
                    const connectButton = document.getElementById('connectWallet');
                    const mintButton = document.getElementById('mintNFT');
                    
                    walletStatus.textContent = `ì—°ê²°ë¨: ${this.account.slice(0, 6)}...${this.account.slice(-4)}`;
                    walletStatus.classList.add('connected');
                    connectButton.textContent = 'ì§€ê°‘ ì—°ê²°ë¨';
                    connectButton.disabled = true;
                    mintButton.disabled = false;
                    
                    console.log('UI ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    
                    // Web3 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
                    if (typeof Web3 !== 'undefined') {
                        this.web3 = new Web3(window.ethereum);
                        console.log('Web3 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ë¨');
                    } else {
                        console.log('Web3 ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ');
                    }
                    
                    // ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸
                    const chainId = await window.ethereum.request({
                        method: 'eth_chainId'
                    });
                    console.log('í˜„ì¬ ë„¤íŠ¸ì›Œí¬ ì²´ì¸ ID:', chainId);
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    alert('ğŸ‰ ì§€ê°‘ ì—°ê²° ì„±ê³µ!\n\nì—°ê²°ëœ ì£¼ì†Œ: ' + this.account);
                    
                } catch (error) {
                    console.error('ì§€ê°‘ ì—°ê²° ì‹¤íŒ¨:', error);
                    
                    if (error.code === 4001) {
                        alert('ì‚¬ìš©ìê°€ ì—°ê²°ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.');
                    } else {
                        alert('ì§€ê°‘ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    }
                }
            }
            
            async switchToMumbai() {
                try {
                    const chainId = await window.ethereum.request({
                        method: 'eth_chainId'
                    });
                    
                    if (chainId !== '0x13881') {
                        try {
                            await window.ethereum.request({
                                method: 'wallet_switchEthereumChain',
                                params: [{ chainId: '0x13881' }],
                            });
                        } catch (switchError) {
                            if (switchError.code === 4902) {
                                await this.addMumbaiNetwork();
                            } else {
                                throw switchError;
                            }
                        }
                    }
                } catch (error) {
                    console.error('Mumbai ë„¤íŠ¸ì›Œí¬ ì „í™˜ ì‹¤íŒ¨:', error);
                    alert('Mumbai í…ŒìŠ¤íŠ¸ë„· ì „í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
            
            showTestTokenInfo() {
                const message = `ğŸ‰ Mumbai í…ŒìŠ¤íŠ¸ë„· ì—°ê²° ì™„ë£Œ!\n\nğŸ’° í…ŒìŠ¤íŠ¸ MATICì´ í•„ìš”í•˜ë©´:\n1. https://faucet.polygon.technology/ ë°©ë¬¸\n2. ì§€ê°‘ ì£¼ì†Œ ì…ë ¥: ${this.account}\n3. ë¬´ë£Œ í…ŒìŠ¤íŠ¸ MATIC ë°›ê¸°\n\nğŸ“ NFT ë¯¼íŒ… ì¤€ë¹„ ì™„ë£Œ!`;
                
                if (confirm(message + '\n\ní…ŒìŠ¤íŠ¸ MATIC ë°›ìœ¼ëŸ¬ ê°ˆê¹Œìš”?')) {
                    window.open('https://faucet.polygon.technology/', '_blank');
                }
            }
            
            async addMumbaiNetwork() {
                try {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: '0x13881',
                            chainName: 'Polygon Mumbai Testnet',
                            nativeCurrency: {
                                name: 'MATIC',
                                symbol: 'MATIC',
                                decimals: 18,
                            },
                            rpcUrls: ['https://rpc-mumbai.maticvigil.com/'],
                            blockExplorerUrls: ['https://mumbai.polygonscan.com/'],
                        }],
                    });
                } catch (addError) {
                    console.error('ë„¤íŠ¸ì›Œí¬ ì¶”ê°€ ì‹¤íŒ¨:', addError);
                    throw addError;
                }
            }
            
            openMintModal() {
                if (Object.keys(this.pixels).length === 0) {
                    alert('ë¨¼ì € í”½ì…€ì•„íŠ¸ë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”!');
                    return;
                }
                document.getElementById('nftModal').style.display = 'block';
            }
            
            closeMintModal() {
                document.getElementById('nftModal').style.display = 'none';
                document.getElementById('nftForm').reset();
            }
            
            async handleMintSubmit(e) {
                e.preventDefault();
                
                const name = document.getElementById('nftName').value;
                const description = document.getElementById('nftDescription').value;
                const attributes = document.getElementById('nftAttributes').value;
                
                try {
                    await this.mintNFT(name, description, attributes);
                } catch (error) {
                    console.error('NFT ë¯¼íŒ… ì‹¤íŒ¨:', error);
                    alert('NFT ë¯¼íŒ…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            }
            
            async mintNFT(name, description, attributes) {
                if (!this.account) {
                    alert('ë¨¼ì € ì§€ê°‘ì„ ì—°ê²°í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                try {
                    // ë¡œë”© í‘œì‹œ
                    document.getElementById('confirmMint').disabled = true;
                    document.getElementById('confirmMint').textContent = 'ë¯¼íŒ… ì¤‘...';
                    
                    // í”½ì…€ì•„íŠ¸ë¥¼ Base64ë¡œ ë³€í™˜
                    const imageData = this.getImageAsBase64();
                    
                    // ë©”íƒ€ë°ì´í„° ìƒì„±
                    const metadata = {
                        name: name,
                        description: description,
                        image: imageData,
                        attributes: this.parseAttributes(attributes),
                        created_by: this.account,
                        created_at: new Date().toISOString(),
                        canvas_size: `${this.gridSize}x${this.gridSize}`,
                        pixel_count: Object.keys(this.pixels).length,
                        network: 'Polygon Mumbai Testnet'
                    };
                    
                    console.log('NFT ë©”íƒ€ë°ì´í„°:', metadata);
                    
                    // ë©”íƒ€ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                    const dataStr = JSON.stringify(metadata, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `${name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_nft_metadata.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    alert(`ğŸ¨ NFT ë©”íƒ€ë°ì´í„° ìƒì„± ì™„ë£Œ!\n\nì‘í’ˆëª…: ${name}\nì„¤ëª…: ${description}\n\n${exportFileDefaultName} íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì‹¤ì œ ë¯¼íŒ…ì„ ìœ„í•´ì„œëŠ” Thirdwebì—ì„œ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•´ì£¼ì„¸ìš”!`);
                    
                    this.closeMintModal();
                    
                } catch (error) {
                    console.error('NFT ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    alert(`ì²˜ë¦¬ ì‹¤íŒ¨: ${error.message}`);
                } finally {
                    document.getElementById('confirmMint').disabled = false;
                    document.getElementById('confirmMint').textContent = 'ë¯¼íŒ…í•˜ê¸°';
                }
            }
            
            getImageAsBase64() {
                // ê²©ì ì—†ëŠ” ê¹¨ë—í•œ ì´ë¯¸ì§€ ìƒì„±
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = this.gridSize;
                tempCanvas.height = this.gridSize;
                
                tempCtx.fillStyle = '#ffffff';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                
                for (const [key, color] of Object.entries(this.pixels)) {
                    const [x, y] = key.split(',').map(Number);
                    tempCtx.fillStyle = color;
                    tempCtx.fillRect(x, y, 1, 1);
                }
                
                return tempCanvas.toDataURL('image/png');
            }
            
            parseAttributes(attributesString) {
                if (!attributesString) return [];
                
                return attributesString.split(',').map(attr => {
                    const [key, value] = attr.split(':').map(s => s.trim());
                    return { trait_type: key, value: value };
                }).filter(attr => attr.trait_type && attr.value);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì—ë””í„° ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            new PixelArtEditor();
        });
    </script>
</body>
</html>
                